<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image Converter — XIZOAHUB Style</title>
  <meta name="description" content="Convert images between PNG, JPG and GIF instantly in the browser. Drag & drop, preview and download." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23111'/%3E%3Ctext x='50' y='58' font-size='38' text-anchor='middle' fill='white' font-family='Arial'%3EIC%3C/text%3E%3C/svg%3E" />
  <style>
    :root{
      --bg1: #0b0f14;
      --bg2: #141821;
      --card: rgba(255,255,255,0.03);
      --accent: #1e90ff;
      --muted: rgba(255,255,255,0.55);
      --glass: rgba(255,255,255,0.03);
      --radius: 12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(30,30,40,0.6), transparent),
                  radial-gradient(800px 400px at 90% 90%, rgba(60,10,10,0.35), transparent),
                  linear-gradient(180deg,var(--bg1),var(--bg2));
      color:#e9eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      gap:20px;
    }

    .container{
      width:100%;
      max-width:980px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:16px;
      padding:28px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);
      border:1px solid rgba(255,255,255,0.03);
      min-height:540px;
    }

    header.top{
      display:flex;
      align-items:center;
      gap:16px;
      margin-bottom:18px;
    }
    .logo{
      width:52px;
      height:52px;
      background:linear-gradient(135deg,#0ea5e9,#7c3aed);
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:18px;
      color:white;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6), inset 0 -6px 18px rgba(255,255,255,0.02);
    }
    .title{
      font-size:20px;
      font-weight:700;
      letter-spacing:0.2px;
    }
    .subtitle{color:var(--muted); font-size:13px; margin-top:4px}

    .grid{
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:20px;
    }

    /* Left: converter card */
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      min-height:380px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .dropzone{
      border:2px dashed rgba(255,255,255,0.06);
      border-radius:12px;
      padding:18px;
      min-height:200px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      transition: border-color 0.18s, transform 0.08s;
      text-align:center;
    }
    .dropzone.dragover{ border-color: rgba(30,144,255,0.9); transform: translateY(-2px) scale(1.005) }

    .dropzone input{ display:none }
    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      background: linear-gradient(90deg,var(--accent), #6ee7b7);
      color:#031124;
      font-weight:600;
      border-radius:10px;
      cursor:pointer;
      border: none;
      box-shadow: 0 6px 18px rgba(30,144,255,0.08);
    }
    .muted{ color:var(--muted); font-size:13px }

    /* Right: preview / options */
    .side{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .panel{
      background:var(--card);
      padding:14px;
      border-radius:12px;
      min-height:120px;
    }

    .preview{
      width:100%;
      height:260px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.02);
    }
    .preview img{ max-width:100%; max-height:100%; object-fit:contain; display:block }

    select, input[type=range]{
      width:100%;
      margin-top:6px;
      padding:8px 10px;
      border-radius:8px;
      background:rgba(255,255,255,0.02);
      color:inherit;
      border:1px solid rgba(255,255,255,0.03);
      outline:none;
    }
    label{ font-size:13px; color:var(--muted) }

    .actions{
      display:flex;
      gap:8px;
      margin-top:8px;
    }
    .btn.ghost{
      background:transparent;
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.04);
    }

    footer.pagefoot{
      margin-top:18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:var(--muted);
      font-size:13px;
    }

    @media (max-width:980px){
      .grid{ grid-template-columns: 1fr; }
      .side{ order:2 }
      .card{ order:1 }
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header class="top" aria-hidden="false">
      <div class="logo">IC</div>
      <div>
        <div class="title">Image Converter</div>
        <div class="subtitle">Convert PNG · JPG · GIF — client-side, fast and private.</div>
      </div>
    </header>

    <div class="grid">
      <section class="card" aria-labelledby="conv-title">
        <h2 id="conv-title" style="margin:0 0 8px 0">Quick Convert</h2>

        <div class="dropzone" id="dropzone">
          <div style="max-width:420px">
            <div style="font-weight:700; font-size:16px">Drop images here</div>
            <div class="muted" style="margin-top:6px">Supports PNG, JPG, GIF. Animated GIFs may lose animation.</div>
            <div style="height:12px"></div>
            <label class="btn" for="fileInput" id="chooseBtn" role="button" tabindex="0">
              Choose file
              <input id="fileInput" type="file" accept="image/*" />
            </label>
            <div style="height:6px"></div>
            <div class="muted" style="font-size:12px">Or drag & drop — maximum single file 25 MB (browser limit).</div>
          </div>
        </div>

        <div style="display:flex; gap:10px; margin-top:12px; align-items:center;">
          <div style="flex:1">
            <label for="format">Output format</label>
            <select id="format" aria-label="Output format">
              <option value="image/png">PNG (lossless)</option>
              <option value="image/jpeg">JPG / JPEG (compressed)</option>
              <option value="image/gif">GIF (single-frame)</option>
            </select>
          </div>

          <div style="width:140px">
            <label for="quality">JPEG quality</label>
            <input id="quality" type="range" min="0.1" max="1" step="0.05" value="0.9" />
          </div>
        </div>

        <div style="display:flex; gap:8px; margin-top:12px; align-items:center;">
          <button class="btn" id="convertBtn">Convert & Download</button>
          <button class="btn ghost" id="resetBtn">Reset</button>
          <div style="flex:1"></div>
          <div class="muted" id="infoText">No file selected</div>
        </div>

      </section>

      <aside class="side">
        <div class="panel">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div style="font-weight:700">Preview</div>
            <div class="muted" style="font-size:12px">Original resolution shown</div>
          </div>
          <div class="preview" id="previewArea" aria-live="polite">
            <div class="muted">Nothing to preview</div>
          </div>
        </div>

        <div class="panel" style="display:flex; flex-direction:column; gap:8px;">
          <div style="font-weight:700">Details</div>
          <div class="muted" id="fileDetails">No file loaded</div>
          <div style="display:flex; gap:8px;">
            <button class="btn ghost" id="downloadBtn" disabled>Download</button>
            <button class="btn ghost" id="openBtn" disabled>Open in new tab</button>
          </div>
        </div>

      </aside>
    </div>

    <footer class="pagefoot">
      <div>Built for creators • Private & client-side</div>
      <div class="muted">Tip: animated GIFs not preserved. Use server tool for animation.</div>
    </footer>
  </div>

  <script>
    // Elements
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const previewArea = document.getElementById('previewArea');
    const infoText = document.getElementById('infoText');
    const fileDetails = document.getElementById('fileDetails');
    const formatSel = document.getElementById('format');
    const convertBtn = document.getElementById('convertBtn');
    const resetBtn = document.getElementById('resetBtn');
    const qualityRange = document.getElementById('quality');
    const downloadBtn = document.getElementById('downloadBtn');
    const openBtn = document.getElementById('openBtn');

    let currentFile = null;
    let currentDataURL = null; // original data URL
    let lastOutputURL = null; // blob URL of last converted file

    // Prevent default for drag events
    ;['dragenter','dragover','dragleave','drop'].forEach(ev=>{
      dropzone.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); });
    });

    // Visuals for dragover
    dropzone.addEventListener('dragover', ()=> dropzone.classList.add('dragover'));
    dropzone.addEventListener('dragleave', ()=> dropzone.classList.remove('dragover'));
    dropzone.addEventListener('drop', (e)=>{
      dropzone.classList.remove('dragover');
      const dt = e.dataTransfer;
      if (dt && dt.files && dt.files.length) handleFiles(dt.files);
    });

    fileInput.addEventListener('change', () => {
      if (fileInput.files) handleFiles(fileInput.files);
    });

    function handleFiles(files) {
      const f = files[0];
      if (!f) return;
      if (!f.type.startsWith('image/')) {
        alert('Please select an image file.');
        return;
      }
      // Limit warning (purely UX)
      if (f.size > 25 * 1024 * 1024) {
        if(!confirm('File is large (>25MB). Continue? This may be slow.')) return;
      }
      currentFile = f;
      infoText.textContent = 'File loaded: ' + f.name;
      fileDetails.textContent = `${f.name} — ${(f.size/1024).toFixed(1)} KB — ${f.type || 'unknown'}`;
      readFileToPreview(f);
    }

    function readFileToPreview(file) {
      const reader = new FileReader();
      reader.onload = e => {
        currentDataURL = e.target.result;
        renderPreview(currentDataURL, file);
      };
      reader.readAsDataURL(file);
    }

    function renderPreview(dataURL, file) {
      previewArea.innerHTML = '';
      const img = document.createElement('img');
      img.src = dataURL;
      img.alt = file.name;
      img.onload = () => {
        // show natural size maybe
      };
      previewArea.appendChild(img);
      downloadBtn.disabled = true;
      openBtn.disabled = true;
      revokeLastURL();
    }

    // Convert & download
    convertBtn.addEventListener('click', async () => {
      if (!currentDataURL) { alert('No image loaded'); return; }
      convertBtn.disabled = true;
      convertBtn.textContent = 'Converting...';
      try {
        const mime = formatSel.value;
        const quality = parseFloat(qualityRange.value) || 0.9;
        const blob = await convertDataURLToBlob(currentDataURL, mime, quality);
        if (!blob) throw new Error('Conversion failed');
        const suggestedName = suggestName(currentFile.name, mime);
        lastOutputURL = URL.createObjectURL(blob);
        downloadBtn.href = lastOutputURL;
        downloadBtn.download = suggestedName;
        downloadBtn.disabled = false;
        openBtn.disabled = false;
        openBtn.onclick = ()=> window.open(lastOutputURL, '_blank');
        // trigger automatic download (optional) - here we won't auto click; let user decide
        infoText.textContent = `Ready — ${suggestedName} (${(blob.size/1024).toFixed(1)} KB)`;
      } catch (err) {
        console.error(err);
        alert('Conversion failed: ' + (err.message || err));
      } finally {
        convertBtn.disabled = false;
        convertBtn.textContent = 'Convert & Download';
      }
    });

    // Reset
    resetBtn.addEventListener('click', ()=>{
      currentFile = null;
      currentDataURL = null;
      previewArea.innerHTML = '<div class="muted">Nothing to preview</div>';
      infoText.textContent = 'No file selected';
      fileDetails.textContent = 'No file loaded';
      fileInput.value = '';
      revokeLastURL();
      downloadBtn.disabled = true;
      openBtn.disabled = true;
    });

    // Utility: convert DataURL to Blob via canvas
    async function convertDataURLToBlob(dataURL, outMime, quality=0.9){
      // Create image element
      const img = await loadImage(dataURL);
      const canvas = document.createElement('canvas');
      // preserve orientation/size
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

      // Special: converting to GIF in-browser often not supported from canvas.toBlob on some browsers.
      // canvas.toDataURL('image/gif') may still work but might produce PNG fallback in some engines.
      // We'll attempt to use canvas.toBlob with requested mime; if that fails, fallback to PNG.
      return await new Promise((resolve, reject) => {
        // try canvas.toBlob if available
        if (canvas.toBlob) {
          canvas.toBlob(blob => {
            if (!blob) {
              // fallback: try dataURL
              try {
                const fallbackData = canvas.toDataURL(outMime, quality);
                const blob2 = dataURLToBlob(fallbackData);
                resolve(blob2);
              } catch (e) { reject(e); }
            } else {
              // If browser produced a blob but with wrong mime (rare), still resolve.
              resolve(blob);
            }
          }, outMime, outMime === 'image/jpeg' ? quality : undefined);
        } else {
          // Older fallback: toDataURL then convert
          try {
            const d = canvas.toDataURL(outMime, quality);
            resolve(dataURLToBlob(d));
          } catch(e) { reject(e); }
        }
      });
    }

    function loadImage(src){
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = ()=> resolve(img);
        img.onerror = (e)=> reject(new Error('Image load failed'));
        // Important for cross-origin images — keep as dataURL or same origin. We're using dataURL, so fine.
        img.src = src;
      });
    }

    function dataURLToBlob(dataurl) {
      // from MDN
      const arr = dataurl.split(',');
      const mime = arr[0].match(/:(.*?);/)[1];
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8arr = new Uint8Array(n);
      while(n--){
        u8arr[n] = bstr.charCodeAt(n);
      }
      return new Blob([u8arr], {type:mime});
    }

    function suggestName(originalName, mime){
      const base = originalName.replace(/\.[^/.]+$/, "");
      const ext = mime === 'image/png' ? 'png' : mime === 'image/jpeg' ? 'jpg' : 'gif';
      return `${base}_converted.${ext}`;
    }

    function revokeLastURL(){
      if (lastOutputURL) {
        try { URL.revokeObjectURL(lastOutputURL); } catch(e){}
        lastOutputURL = null;
      }
    }

    // support clicking downloadBtn
    downloadBtn.addEventListener('click', (e)=> {
      if (downloadBtn.disabled) e.preventDefault();
    });

    // Initialize small helpers
    (function init(){
      // default format set
      formatSel.value = 'image/png';
      qualityRange.style.display = 'block';
      formatSel.addEventListener('change', ()=>{
        qualityRange.style.display = (formatSel.value === 'image/jpeg') ? 'block' : 'none';
      });
      // small keyboard support: space to choose file
      document.getElementById('chooseBtn').addEventListener('keydown', e=>{
        if (e.key === 'Enter' || e.key === ' ') { fileInput.click(); e.preventDefault(); }
      });
    })();

  </script>
</body>
</html>
